import{l as S}from"./index-DdI-Egwi.js";import{_ as V,k as B}from"./_plugin-vue_export-helper-fxonzzrb.js";import{k as N,m as T,n as y,o as a,c,a as l,b as v,w as z,p as _,F as A,y as I,e as d,r as p,L as F,i as U,q,t as m}from"./index-Dyl5uCa_.js";const D={class:"logs-view"},E={class:"section-card"},H={class:"logs-header"},M={class:"logs-actions"},R={key:0,class:"empty-hint"},j={class:"log-time"},G={key:0,class:"log-tag"},J={class:"log-msg"},K={__name:"AccountLogs",props:{uin:String},setup(h){const i=h,t=d([]),u=d(!0),r=d(null);let s=null;function w(o){if(!o)return"";if(o.level==="warn")return"log-warn";if(o.level==="error")return"log-error";const e=(o.msg||"").toLowerCase();return e.includes("错误")||e.includes("失败")?"log-error":e.includes("警告")?"log-warn":e.includes("成功")||e.includes("收获")||e.includes("偷取")?"log-success":""}function g(){!u.value||!r.value||F(()=>{r.value.scrollTop=r.value.scrollHeight})}function b(){t.value=[]}async function f(){try{const o=await B(i.uin);t.value=o.data||[],g()}catch{}}function k(){const o=window.location.protocol+"//"+window.location.hostname+":3000";s=S(o,{transports:["websocket"]}),s.on("connect",()=>{s.emit("logs:subscribe",i.uin)}),s.on("bot:log",e=>{String(e.userId)===String(i.uin)&&(t.value.push(e),t.value.length>2e3&&(t.value=t.value.slice(-1500)),g())}),s.on("logs:history",e=>{String(e.uin)===String(i.uin)&&(t.value=e.logs||[],g())})}return N(()=>i.uin,(o,e)=>{t.value=[],s&&s.connected&&(e&&s.emit("logs:unsubscribe",e),s.emit("logs:subscribe",o)),f()}),T(()=>{f(),k()}),y(()=>{s&&(s.emit("logs:unsubscribe",i.uin),s.disconnect(),s=null)}),(o,e)=>{const L=p("el-switch"),C=p("el-button");return a(),c("div",D,[l("div",E,[l("div",H,[e[2]||(e[2]=l("h3",{class:"section-title"},"运行日志",-1)),l("div",M,[v(L,{modelValue:u.value,"onUpdate:modelValue":e[0]||(e[0]=n=>u.value=n),"active-text":"自动滚动","inactive-text":"",size:"small"},null,8,["modelValue"]),v(C,{size:"small",onClick:b},{default:z(()=>[...e[1]||(e[1]=[U("清空",-1)])]),_:1})])]),l("div",{class:"log-container",ref_key:"logContainer",ref:r},[t.value.length===0?(a(),c("div",R,"暂无日志")):_("",!0),(a(!0),c(A,null,I(t.value,(n,x)=>(a(),c("div",{key:x,class:q(["log-line",w(n)])},[l("span",j,m(n.time||""),1),n.tag?(a(),c("span",G,"["+m(n.tag)+"]",1)):_("",!0),l("span",J,m(n.msg||""),1)],2))),128))],512)])])}}},W=V(K,[["__scopeId","data-v-6f30f436"]]);export{W as default};
