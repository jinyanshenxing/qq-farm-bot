import{n as j,k as te,o as i,s as B,z as ne,w as o,b as a,i as S,c as f,a as t,d as H,p as y,r,e as p,x as N,m as se,t as b,f as k,A as ae,F as le,y as oe,u as ie,q as re,B as ue,C as de,D as ce,E as w,G as ve}from"./index-Dyl5uCa_.js";import{u as me}from"./auth-B1At1j8b.js";import{_ as J,g as fe,c as _e,s as pe,a as ge,b as be,d as he}from"./_plugin-vue_export-helper-fxonzzrb.js";import{o as O,a as P}from"./index-Ci_heb7m.js";import"./index-DdI-Egwi.js";const qe={key:0},ye={key:1,class:"qr-container"},ke={class:"qr-image-wrapper"},we=["src"],Ce={key:2,class:"qr-container"},Se={key:3,class:"qr-container"},xe={__name:"QrCodeDialog",props:{visible:Boolean,qrBase64:String,qrStatus:String,qrUin:String},emits:["update:visible","confirm","cancel"],setup(u,{emit:R}){const x=u,d=R,C=p(window.innerWidth<=768);function z(){C.value=window.innerWidth<=768}window.addEventListener("resize",z),j(()=>window.removeEventListener("resize",z));const U=N({get:()=>x.visible,set:g=>d("update:visible",g)}),c=p({uin:"",platform:"qq",farmIntervalSec:10,friendIntervalSec:10}),h=p(0),I=p(100);let v=null;te(()=>x.qrStatus,g=>{g==="pending"?(h.value=Date.now(),q()):_()});function q(){_();const g=18e4;v=setInterval(()=>{const s=Date.now()-h.value;I.value=Math.max(0,100-s/g*100),s>=g&&_()},500)}function _(){v&&(clearInterval(v),v=null)}j(_);function D(){c.value.uin.trim()&&d("confirm",{uin:c.value.uin.trim(),platform:c.value.platform,farmInterval:c.value.farmIntervalSec*1e3,friendInterval:c.value.friendIntervalSec*1e3})}function V(){d("cancel"),d("update:visible",!1)}function W(){d("update:visible",!1),setTimeout(()=>d("update:visible",!0),200)}return(g,s)=>{const F=r("el-input"),Q=r("el-form-item"),E=r("el-input-number"),T=r("el-form"),A=r("el-skeleton"),L=r("el-progress"),e=r("el-result"),n=r("el-button"),$=r("el-dialog");return i(),B($,{modelValue:U.value,"onUpdate:modelValue":s[3]||(s[3]=m=>U.value=m),title:"添加账号 - QQ 扫码登录",width:C.value?"92%":"480px","close-on-click-modal":!1,onClose:V},ne({default:o(()=>[u.qrStatus==="idle"||u.qrStatus==="loading"?(i(),f("div",qe,[a(T,{model:c.value,"label-width":"100px",onSubmit:H(D,["prevent"])},{default:o(()=>[a(Q,{label:"QQ号",required:""},{default:o(()=>[a(F,{modelValue:c.value.uin,"onUpdate:modelValue":s[0]||(s[0]=m=>c.value.uin=m),placeholder:"请输入QQ号作为标识",disabled:u.qrStatus==="loading"},null,8,["modelValue","disabled"])]),_:1}),a(Q,{label:"农场巡查"},{default:o(()=>[a(E,{modelValue:c.value.farmIntervalSec,"onUpdate:modelValue":s[1]||(s[1]=m=>c.value.farmIntervalSec=m),min:1,max:3600,step:5,disabled:u.qrStatus==="loading"},null,8,["modelValue","disabled"]),s[4]||(s[4]=t("span",{class:"unit-text"},"秒",-1))]),_:1}),a(Q,{label:"好友巡查"},{default:o(()=>[a(E,{modelValue:c.value.friendIntervalSec,"onUpdate:modelValue":s[2]||(s[2]=m=>c.value.friendIntervalSec=m),min:1,max:3600,step:5,disabled:u.qrStatus==="loading"},null,8,["modelValue","disabled"]),s[5]||(s[5]=t("span",{class:"unit-text"},"秒",-1))]),_:1})]),_:1},8,["model"])])):u.qrStatus==="pending"?(i(),f("div",ye,[s[6]||(s[6]=t("div",{class:"qr-hint"},"请使用 QQ 扫描下方二维码",-1)),t("div",ke,[u.qrBase64?(i(),f("img",{key:0,src:u.qrBase64,class:"qr-image",alt:"登录二维码"},null,8,we)):(i(),B(A,{key:1,rows:0,animated:"",style:{width:"300px",height:"300px"}}))]),s[7]||(s[7]=t("div",{class:"qr-tip"},"二维码有效时间约 3 分钟",-1)),a(L,{percentage:I.value,"stroke-width":4,"show-text":!1,status:"success",style:{"margin-top":"12px"}},null,8,["percentage"])])):u.qrStatus==="scanned"?(i(),f("div",Ce,[a(e,{icon:"success",title:"扫码成功","sub-title":"正在登录游戏..."})])):u.qrStatus==="error"?(i(),f("div",Se,[a(e,{icon:"error",title:"扫码失败","sub-title":"二维码已过期或出错，请重试"},{extra:o(()=>[a(n,{type:"primary",onClick:W},{default:o(()=>[...s[8]||(s[8]=[S("重新获取",-1)])]),_:1})]),_:1})])):y("",!0)]),_:2},[u.qrStatus==="idle"||u.qrStatus==="loading"?{name:"footer",fn:o(()=>[a(n,{onClick:V},{default:o(()=>[...s[9]||(s[9]=[S("取消",-1)])]),_:1}),a(n,{type:"primary",onClick:D,loading:u.qrStatus==="loading",disabled:!c.value.uin.trim()},{default:o(()=>[...s[10]||(s[10]=[S(" 获取二维码 ",-1)])]),_:1},8,["loading","disabled"])]),key:"0"}:u.qrStatus==="pending"?{name:"footer",fn:o(()=>[a(n,{onClick:V},{default:o(()=>[...s[11]||(s[11]=[S("取消",-1)])]),_:1})]),key:"1"}:void 0]),1032,["modelValue","width"])}}},Ie=J(xe,[["__scopeId","data-v-7dbf2083"]]),Ve={class:"dashboard-view"},Qe={class:"stats-grid"},$e={class:"stat-card"},Be={class:"stat-icon icon-blue"},ze={class:"stat-info"},Ue={class:"stat-value"},De={class:"stat-card"},Ee={class:"stat-icon icon-green"},Te={class:"stat-info"},Ae={class:"stat-value"},Le={class:"stat-card"},Me={class:"stat-icon icon-red"},Ne={class:"stat-info"},Re={class:"stat-value"},We={class:"stat-card"},Fe={class:"stat-icon icon-grey"},Ge={class:"stat-info"},Oe={class:"stat-value"},Pe={key:0,class:"toolbar"},je={class:"account-grid"},He=["onClick"],Je={class:"acc-header"},Ke=["src","alt"],Xe={class:"acc-header-info"},Ye={class:"acc-header-top"},Ze={class:"acc-uin"},et={class:"acc-sub"},tt={class:"acc-details"},nt={key:0},st={key:1,class:"gold"},at={class:"acc-footer"},lt={key:0,class:"empty-state"},ot={__name:"DashboardView",setup(u){const R=ie(),x=me(),d=p([]),C=p(!1),z=N(()=>d.value.filter(e=>e.status==="running").length),U=N(()=>d.value.filter(e=>e.status==="error").length),c=N(()=>d.value.filter(e=>e.status==="stopped"||e.status==="idle").length),h=p(!1),I=p(""),v=p("idle"),q=p("");async function _(){C.value=!0;try{const e=await fe();d.value=e.data||[]}catch{}finally{C.value=!1}}async function D(e){try{await ge(e),w.success("启动中..."),_()}catch(n){w.error(n.message)}}async function V(e){try{await be(e),w.success("已停止"),_()}catch(n){w.error(n.message)}}async function W(e){try{await ve.confirm(`确定删除账号 ${e}？`,"确认",{type:"warning"}),await he(e),w.success("已删除"),_()}catch{}}async function g(e){q.value=e.uin,v.value="loading";try{const n=await pe(e.uin,{platform:e.platform,farmInterval:e.farmInterval,friendInterval:e.friendInterval});I.value=n.data.qrBase64,v.value="pending"}catch(n){v.value="error",w.error(n.message)}}function s(){q.value&&v.value==="pending"&&_e(q.value).catch(()=>{}),h.value=!1,v.value="idle"}function F(e){return e?Number(e).toLocaleString():""}function Q(e){return{running:"success",error:"danger",connecting:"warning","qr-pending":"warning"}[e]||"info"}function E(e){return{running:"运行中",error:"异常",connecting:"连接中","qr-pending":"扫码中",stopped:"已停止",idle:"空闲"}[e]||e}function T(e){const n=d.value.findIndex($=>$.uin===e.userId);n>=0?d.value[n].status=e.newStatus:_()}function A(e){e.uin===q.value&&(v.value="scanned",setTimeout(()=>{h.value=!1,_()},1500))}function L(e){e.uin===q.value&&(v.value="error",w.warning(e.reason||"二维码已过期"))}return se(()=>{_(),O("bot:statusChange",T),O("qr:scanned",A),O("qr:expired",L)}),j(()=>{P("bot:statusChange",T),P("qr:scanned",A),P("qr:expired",L)}),(e,n)=>{const $=r("User"),m=r("el-icon"),K=r("CircleCheck"),X=r("Warning"),Y=r("Remove"),M=r("el-button"),Z=r("el-tag"),ee=r("el-empty");return i(),f("div",Ve,[t("div",Qe,[t("div",$e,[t("div",Be,[a(m,{size:24},{default:o(()=>[a($)]),_:1})]),t("div",ze,[t("div",Ue,b(d.value.length),1),n[3]||(n[3]=t("div",{class:"stat-label"},"总账号",-1))])]),t("div",De,[t("div",Ee,[a(m,{size:24},{default:o(()=>[a(K)]),_:1})]),t("div",Te,[t("div",Ae,b(z.value),1),n[4]||(n[4]=t("div",{class:"stat-label"},"运行中",-1))])]),t("div",Le,[t("div",Me,[a(m,{size:24},{default:o(()=>[a(X)]),_:1})]),t("div",Ne,[t("div",Re,b(U.value),1),n[5]||(n[5]=t("div",{class:"stat-label"},"异常",-1))])]),t("div",We,[t("div",Fe,[a(m,{size:24},{default:o(()=>[a(Y)]),_:1})]),t("div",Ge,[t("div",Oe,b(c.value),1),n[6]||(n[6]=t("div",{class:"stat-label"},"已停止",-1))])])]),k(x).isAdmin?(i(),f("div",Pe,[a(M,{type:"primary",icon:k(ae),onClick:n[0]||(n[0]=l=>h.value=!0)},{default:o(()=>[...n[7]||(n[7]=[S("添加账号",-1)])]),_:1},8,["icon"])])):y("",!0),t("div",je,[(i(!0),f(le,null,oe(d.value,l=>(i(),f("div",{key:l.uin,class:"account-card",onClick:G=>k(R).push(`/account/${l.uin}`)},[t("div",Je,[t("img",{class:"acc-avatar",src:`https://q1.qlogo.cn/g?b=qq&nk=${l.uin}&s=100`,alt:l.uin},null,8,Ke),t("div",Xe,[t("div",Ye,[t("span",Ze,b(l.nickname||l.uin),1),t("div",{class:re(["acc-status-dot",l.status])},null,2)]),t("div",et,b(l.uin),1)])]),t("div",tt,[l.level?(i(),f("span",nt,"Lv"+b(l.level),1)):y("",!0),l.gold?(i(),f("span",st,b(F(l.gold))+" 金币",1)):y("",!0)]),t("div",at,[a(Z,{type:Q(l.status),size:"small",round:"",effect:"dark"},{default:o(()=>[S(b(E(l.status)),1)]),_:2},1032,["type"]),t("div",{class:"acc-actions",onClick:n[1]||(n[1]=H(()=>{},["stop"]))},[l.status!=="running"?(i(),B(M,{key:0,type:"success",size:"small",plain:"",circle:"",icon:k(ue),onClick:G=>D(l.uin),title:"启动"},null,8,["icon","onClick"])):y("",!0),l.status==="running"?(i(),B(M,{key:1,type:"warning",size:"small",plain:"",circle:"",icon:k(de),onClick:G=>V(l.uin),title:"停止"},null,8,["icon","onClick"])):y("",!0),k(x).isAdmin?(i(),B(M,{key:2,type:"danger",size:"small",plain:"",circle:"",icon:k(ce),onClick:G=>W(l.uin),title:"删除"},null,8,["icon","onClick"])):y("",!0)])])],8,He))),128)),d.value.length===0&&!C.value?(i(),f("div",lt,[a(ee,{description:"暂无账号"})])):y("",!0)]),a(Ie,{visible:h.value,"onUpdate:visible":n[2]||(n[2]=l=>h.value=l),"qr-base64":I.value,"qr-status":v.value,"qr-uin":q.value,onConfirm:g,onCancel:s},null,8,["visible","qr-base64","qr-status","qr-uin"])])}}},vt=J(ot,[["__scopeId","data-v-e306af78"]]);export{vt as default};
